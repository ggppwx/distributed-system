#ifndef yfs_client_h
#define yfs_client_h

#include <string>
//#include "yfs_protocol.h"
#include "extent_client.h"
#include <vector>

#include "lock_protocol.h"
#include "lock_client.h"

class yfs_client {
  extent_client *ec;
 public:

<<<<<<< HEAD:yfs_client.h
  typedef unsigned long long inum;
  enum xxstatus { OK, RPCERR, NOENT, IOERR, FBIG, EXIST };
=======
  typedef unsigned long long inum;    //64 bit inum
  enum xxstatus { OK, RPCERR, NOENT, IOERR, FBIG };
>>>>>>> lab3:yfs_client.h
  typedef int status;

  struct fileinfo {
    unsigned long long size;
    unsigned long atime;
    unsigned long mtime;
    unsigned long ctime;
  };
  struct dirinfo {
    unsigned long atime;
    unsigned long mtime;
    unsigned long ctime;
  };
  struct dirent {
    std::string name;
    unsigned long long inum;
  };
	
//	std::vector<dirent>  dirents;
	
	struct filenode {
		fileinfo info;
		std::string filedata;
	};
	
	struct dirnode {
		dirinfo info;
		std::vector<dirent>  dircontents;
	};

 private:
  static std::string filename(inum);
  static inum n2i(std::string);
 public:

  yfs_client(std::string, std::string);

  bool isfile(inum);
  bool isdir(inum);

  int getfile(inum, fileinfo &);
  int getdir(inum, dirinfo &);
	
  //lsb2 
	
	
	unsigned long get_fuseid(inum);
	
	
	int createfile(std::string, inum, filenode, inum&);
	int createdir(std::string, inum);
	int lookupfile(std::string, inum, inum &, bool &);	
	int readdir(inum, std::vector<dirent> &);
	//lab3 readfile writefile
	int do_truncate(inum , size_t );
	
	int writedir();
	int readfile(inum, std::string &, size_t &);
	int writefile(inum, std::string, size_t, off_t, size_t & );
	int modifyfile(inum, std::string, size_t, off_t, size_t);
	int setfile(inum, fileinfo);
	int setdir(inum, dirinfo);
};


inline unmarshall &
operator>>(unmarshall &u, yfs_client::dirent &a)
{
	u >> a.name;
	u >> a.inum;
//	printf(".....UNmarshall successful..:%lld and %s\n",a.inum,a.name.c_str());
	return u;
}

inline marshall &
operator<<(marshall &m, yfs_client::dirent a)
{
	
	m << a.name;
	m << a.inum;
//	printf(".....marshall successful..:%lld and %s\n",a.inum,a.name.c_str());
	return m;
}
#endif 
